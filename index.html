<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>хера чё я умею не зря пары прогуливал</title>
</head>
<body>
    <div id="main">
        <a id="ras" class="sliding-button">Расписание</a>
        <a id="lec" href="https://drive.google.com/drive/folders/1kTotTTT2Nc5Uucr0dU3sCeF3lzgUTGky" class="sliding-button">Лекции</a>
        <a id="zwon" class="sliding-button">Расписание звонков</a>
    </div>
    <p id="weekType"></p>
    <div id ="ras1">
        <table>
        <tr>
          <th>№</th>
          <th>Понедельник</th>
          <th>Вторник</th>
          <th>Среда</th>
          <th>Четверг</th>
          <th>Пятница</th>
          <th>Суббота</th>
          </tr>
         <tr>
          <td>1</td>
          <td>ЭПРТ<br>Шадчнева 205</td>
          <td>МДК 06.03<br>Демаева 406<br>——————————<br>МДК 06.04<br>Демаева 406</td>
          <td>МДК 06.03 <br>Демаева 406</td>
          <td>МДК 10.03 <br>Типцова 404</td>
          <td>МДК 06.03 <br>Демаева 406</td>
          <td>ОПД<br>Бондарева 305</td>
         </tr>
        <tr>
          <td>2</td>
          <td>МДК 07.01<br>Королёва</td>
          <td>МДК 10.03 <br>Типцова 404</td>
          <td>ЭПРТ<br>Шадчнева 205<br>——————————<br>МДК 07.01<br>Королёва</td>
          <td>ЭПРТ<br>Шадчнева 205</td>
          <td>МДК 13.01<br>Болочагина 401</td>
          <td>МДК 13.01<br>Болочагина 401</td>
        </tr>
        <tr>
          <td>3</td>
          <td>МДК 06.04 <br>Демаева 406</td>
          <td>МДК 03.02 <br>Демаева 406</td>
          <td>ОПД<br>Бондарева 305<br>——————————<br>МДК 10.02<br>Типцова 404</td>
          <td>ОПД<br>Бондарева 305</td>
          <td>Менеджмент<br>Дасаева 408</td>
          <td>МДК 13.02<br>Дасаева 408</td>
        </tr>
        <tr>
          <td>4</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
        </tr>

        </table>

        <a id="bras" class="sliding-button">back</a>
    </div>
    <div id = ras2>
        <table>
            <tr>
                <th>№</th>
                <th>Основное</th>
                <th>Суббота</th>
            </tr>
            <tr>
                <td>1</td>
                <td>8:00 8:45<br>
                    8:50 9:35 </td>
                <td>8:00<br>
                    9:00</td>
              </tr>
              <tr>
                <td>2</td>
                <td>9:45 10:30 <br>
                    10:35 11:20 </td>
                <td>9:10<br>
                    10:10</td>
              </tr>
              <tr>
                <td>3</td>
                <td>11:40 12:25 <br>
                    12:30 13:15</td>
                <td>10:20<br>
                    11:20</td>
              </tr>
              <tr>
                <td>4</td>
                <td>13:25 14:10 <br>
                    14:15 15:00</td>
                <td>4 пара в субботу ?</td>
              </tr>
        </table>
        <a id="bras1" class="sliding-button">back</a>
        <div id="schedule"></div>
    </div>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        let zwon = document.getElementById("zwon");
        let ras = document.getElementById("ras");
        let tg=window.Telegram.WebApp;
        tg.expand();
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
            .then(function(registration) {
                console.log('Service Worker зарегистрирован успешно:', registration);
        
                // Логика для проверки обновлений
                registration.onupdatefound = function() {
                    const installingWorker = registration.installing;
                    installingWorker.onstatechange = function() {
                        if (installingWorker.state === 'installed') {
                            if (navigator.serviceWorker.controller) {
                                // Новая версия доступна, уведомляем пользователя или автоматически обновляем
                                if (confirm("Новая версия доступна. Обновить?")) {
                                    window.location.reload();
                                }
                            }
                        }
                    };
                };
            })
            .catch(function(error) {
                console.log('Ошибка при регистрации Service Worker:', error);
            });
        }

        zwon.addEventListener("click", () => {
            document.getElementById("weekType").style.display="none";
            document.getElementById("main").style.display ="none";
            document.getElementById("ras2").style.display ="block";
            document.getElementById("schedule").style.display="block";
        })
        let bras1 = document.getElementById("bras1");
        bras1.addEventListener("click", () => {
            document.getElementById("weekType").style.display="block";
            document.getElementById("main").style.display ="block";
            document.getElementById("ras2").style.display ="none";
            document.getElementById("schedule").style.display="none";

        });
        ras.addEventListener("click", () => {
            document.getElementById("weekType").style.display="none";
            document.getElementById("main").style.display ="none";
            document.getElementById("ras1").style.display ="block";
        });
        let bras = document.getElementById("bras");
        bras.addEventListener("click", () => {
            document.getElementById("weekType").style.display="block";
            document.getElementById("main").style.display ="block";
            document.getElementById("ras1").style.display ="none";

        });
        // Получаем текущую дату
        var currentDate = new Date();

        // Получаем номер недели в году
        var weekNumber = getWeekNumber(currentDate);

        // Определяем тип недели (числитель или знаменатель)
        var weekType = weekNumber % 2 === 0 ? "Числитель(это с верху)" : "Знаменатель(это с низу)";

        // Выводим тип недели на страницу
        document.getElementById("weekType").innerHTML = "Сейчас " + weekType + " неделя";

        // Функция для получения номера недели в году
        function getWeekNumber(date) {
            var d = new Date(date);
            d.setHours(0, 0, 0, 0);
            d.setDate(d.getDate() + 4 - (d.getDay() || 7));
            var yearStart = new Date(d.getFullYear(), 0, 1);
            var weekNumber = Math.ceil(((d - yearStart) / 86400000 + 1) / 7);
            return weekNumber;
        }




        //pull to refresh
        
        
        // Задаем расписание звонков для понедельника - пятницы
        const weekdaySchedule = [
        { начало: '8:00', конец: '9:35' },
        { начало: '9:45', конец: '11:20' },
        { начало: '11:40', конец: '13:15' },
        { начало: '13:25', конец: '15:00' },
        // Добавьте остальные пары для понедельника - пятницы
        ];

        // Задаем расписание звонков для субботы
        const saturdaySchedule = [
        { начало: '8:00', конец: '9:00' },
        { начало: '9:10', конец: '10:10' },
        { начало: '10:20', конец: '11:20' }
        // Добавьте остальные пары для субботы
        ];

        // Функция для получения текущего дня недели
        function getCurrentDayOfWeek() {
        const daysOfWeek = ['воскресенье', 'понедельник', 'вторник', 'среда', 'четверг', 'пятница', 'суббота'];
        const currentDate = new Date();
        return daysOfWeek[currentDate.getDay()];
        }

        // Функция для вычисления оставшегося времени до пары или до конца пары
        function calculateTimeUntilNextClass() {
        const currentDayOfWeek = getCurrentDayOfWeek();
        const currentTime = new Date();
        let schedule;

        if (currentDayOfWeek === 'суббота') {
            schedule = saturdaySchedule;
        } else if (currentDayOfWeek !== 'воскресенье') {
            schedule = weekdaySchedule;
        } else {
            return 'Сегодня выходной.';
        }

        for (const classTime of schedule) {
            const classStart = new Date();
            const classEnd = new Date();

            const [startHour, startMinute] = classTime.начало.split(':');
            const [endHour, endMinute] = classTime.конец.split(':');

            classStart.setHours(parseInt(startHour), parseInt(startMinute), 0, 0);
            classEnd.setHours(parseInt(endHour), parseInt(endMinute), 0, 0);
            
            

            if (currentTime >= classStart && currentTime < classEnd) {
            // Пара идет, вычисляем оставшееся время до конца пары
            const timeRemaining = new Date(classEnd - currentTime);
            const hours = Math.floor((timeRemaining % 86400000) / 3600000);
            const minutes = timeRemaining.getMinutes();
            const seconds = timeRemaining.getSeconds();
            return `До конца пары осталось ${hours}:${minutes}:${seconds < 10 ? '0' : ''}${seconds} секунд.`;
            } else if (currentTime < classStart) {
            // Пара еще не началась, вычисляем оставшееся время до начала пары
            const timeRemaining = new Date(classStart - currentTime);
            const hours = Math.floor((timeRemaining % 86400000) / 3600000);
            const minutes = timeRemaining.getMinutes();
            const seconds = timeRemaining.getSeconds();
            
            return `До начала пары осталось ${hours}:${minutes}:${seconds < 10 ? '0' : ''}${seconds} секунд.`;
            }
        }

        return 'На сегодня больше пар нет.';
        }

        // Отображаем оставшееся время до пары или до конца пары на странице
        const scheduleElement = document.getElementById('schedule');
        scheduleElement.textContent = calculateTimeUntilNextClass();

        // Обновляем информацию каждую секунду
        setInterval(function () {
        scheduleElement.textContent = calculateTimeUntilNextClass();
        }, 1000); // Обновляем каждую секунду

    </script>

</body>
</html>
